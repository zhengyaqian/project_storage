<!doctype html>
<html>
<head>
    <title>火绒终端安全控制中心</title>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" />
		<link rel="stylesheet" href="css/font-awesome-4.7.0/css/font-awesome.css" />
	<link href="css/common.css" rel="stylesheet">
    <link href="css/terminalArrange.css" rel="stylesheet">
    <script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/json3.js"></script>
	<script src="js/jquery.page.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	
    <link href="css/lyz.calendar.css" rel="stylesheet" type="text/css" />

</head>
<body>
    <div class="main">
        <div class="topHint">
            <img src="images/EWEW.png">
            <p>火绒终端安全管理系统工具集，帮您轻松搞定终端安全管理</p>
            <p>请根据需要选择工具</p>
        </div>
    
        <div class="bgContainer">
            <div class="container">
            <div class="table">
                <!-- <table>
                    <tr>
                        <td class="relative" width="980">
                            <img src='images/terminalA1.png'>
                            <div class="absoluteTxt">
                                <h3>分享下载地址</h3>
                                <p>您可以直接复制以下网页地址,通过各类工具将地址发送给需要安装客户端的终端用户</p>
                                <p><a class="webLink"></a><a class="cursor copyButton" onclick="copyUrl(this)">复制链接</a></p>
                                <input type="text" value="" class="copyUrl">

                            </div>

                        </td>
                        <td class="relative">
                            <div class="absolute buttons">
                                <a class="button cursor" onclick="terminalASPop()">终端部署设置</a>
                                <a class="button cursor" href="/deploy/download.html" target="_blank">预览网页</a>
                            </div>
                        </td>

                    </tr>
                </table> -->
                <table style="margin-top:10px;" id="dDTool">
                    <tr>
                        <td class="relative" width="980">
                            <img src='images/terminalA4.png'>
                            <div class="absoluteTxt fieldA">
                                <h3>域部署工具</h3>
                                <p>在域的环境下，域管理员可以向域用户强制推送安装火绒终端安全软件</p>
                                <p><a href="/docs/HRDomainSetup.pdf" target="_blank" style="color: rgb(99, 195, 128);cursor: pointer;">查看使用文档</a>，教您如何安装部署登录脚本或开机脚本进行域部署</p>
                            </div>

                        </td>
                        <td>

                                <a class="button cursor toolDButton" href="/tools/HRDomainSetup.exe">工具下载</a>

                        </td>

                    </tr>
                </table>
                <table style="margin-top:10px;" id="tTask">
                    <tr>
                        <td class="relative" width="980">
                            <img src='images/terminalA5.png'>
                            <div class="absoluteTxt fieldA">
                                <h3>定时任务</h3>
                                <p>对指定终端分组设置病毒查杀、关机重启等定时任务策略</p>
                            </div>

                        </td>
                        <td>

                                <a class="button cursor toolDButton tTButton">定时任务</a>

                        </td>

                    </tr>
                </table>
                <table style="margin-top:10px;" id="lCTool">
                    <tr>
                        <td class="relative" width="980">
                            <img src='images/terminalA3.png'>
                            <div class="absoluteTxt">
                                <h3>日志清理工具</h3>
                                <p>当前管理中心的数据日志大小为 <font id="lognum"></font>；您可以通过日志清理工具，减少数据库的大小。</p>
                                <p id="haveCleanS"><span class="verticalMiddle">清理日志任务：将会在最近的00:00清理2017-7-1之前的所有日志</span><a class="cursor cancellCButton" onclick="cancelCPop()">停止清理</a></p>

                            </div>

                        </td>
                        <td>

                                <a class="button cursor cleanLButton">清理日志</a>

                        </td>

                    </tr>
                </table>
                <table style="margin-top:10px;">
                    <tr>
                        <td class="relative" width="980">
                            <img src='images/terminalA2.png'>
                            <div class="absoluteTxt fieldA">
                                <h3>离线升级工具</h3>
                                <p>当控制中心不能连接外网时，您可以通过离线升级工具更新控制中心以及补丁。</p>
								<p><a href="/docs/HROffline.pdf" style="color: rgb(99, 195, 128);cursor: pointer;" target="_blank" >查看使用文档</a>，教您如何使用离线升级工具进行离线升级</p>
                            </div>
                        </td>
                        <td>
                                <a class="button cursor offlineButton" href="/tools/HROffline.exe">工具下载</a>

                        </td>

                    </tr>
				</table> 
				<table style="margin-top:10px;">
                    <tr>
                        <td class="relative" width="980">
                            <img src='images/linux.png'>
                            <div class="absoluteTxt fieldA">
                                <h3>Linux版</h3>
                                <p>适用于Linux操作系统的客户端。</p>
                            </div>
                        </td>
                        <td>
                                <a class="button cursor offlineButton" href="/tools/linux-inst.sh">软件下载</a>

                        </td>

                    </tr>
                </table> 
            </div>
        </div>
        </div>
    </div>
    <div class="shade"></div>
    <div class="terminalASPop pop">
        <div class="title">终端部署设置<span class="closeW"></span></div>
        <div class="content">
            <!-- <div class="block">
                <p>设置安装包通信地址（终端将通过此IP地址,端口与管理中心通信，从而安装终端）</p>
                <p>地址内容 : <select id="addressContent"></select> <span class="hidden">域名 : </span><input type="text" id="port" class="hidden"></p>

            </div> -->
            <div class="block">
                <p>终端安装公告页面内容</p>
                <p class="titleText"><input id="noticeTitle" type="text" maxlength="20"></p>
                <p>
                    <textarea id="noticeContent" maxlength="120">

                    </textarea>
                </p>
            </div>


        </div>
        <div class="buttons">
            <a class="closeW">取消</a>
            <a onclick="submitTASet(this)">确定</a>
            
            <div class="clear"></div>
        </div>
    </div>
    <div class="unSetRulePop pop">
        <div class="title">温馨提示<span class="closeW"></span></div>
        <div class="left"><img src="images/terTips.png"></div>
        <div class="right">
            <p class="describe"><span class="verticalMiddle">你尚未设置终端接入规则</span></p>
            <p class="describe">设置终端接入规则后可以更加方便的进行终端管理</p>

        </div>
        <div class="clear"></div>
        <div class="buttons"><a onclick="hideButton(this)">以后再说</a><a onclick="goImmediately(this)" class="sure">立即前去</a></div>
    </div>
    <!-- 日志清理弹窗 -->
    <div class="cleanLogPop pop">
        <div class="title">日志清理<span class="closeW"></span></div>
        <div class="content">
            <div class="block">
                <p>日志清理设置</p>
                <p>清理<input id="cleanLogDate" class="verticalMiddle">之前的所有事件日志</p>
                <p>
                    <span>请指定开始清理的时间为最近的</span>
                    <select id="cleanLogTime">
                        <option value=0>0点</option>
                        <option value=1>1点</option>
                        <option value=2>2点</option>
                        <option value=3>3点</option>
                        <option value=4>4点</option>
                        <option value=5>5点</option>
                        <option value=6>6点</option>
                        <option value=7>7点</option>
                        <option value=8>8点</option>
                        <option value=9>9点</option>
                        <option value=10>10点</option>
                        <option value=11>11点</option>
                        <option value=12>12点</option>
                        <option value=13>13点</option>
                        <option value=14>14点</option>
                        <option value=15>15点</option>
                        <option value=16>16点</option>
                        <option value=17>17点</option>
                        <option value=18>18点</option>
                        <option value=19>19点</option>
                        <option value=20>20点</option>
                        <option value=21>21点</option>
                        <option value=22>22点</option>
                        <option value=23>23点</option>

                    </select>
                </p>

            </div>
            <div class="block lastBlock">
                <p>备注：</p>
                <p>1. 为了维持系统的稳定，只能清理7天以前的日志</p>
                <p>2. 建议不要立即执行日志的清理工作</p>
                <p>3. 日志清理的过程中会有查询问题，完成后恢复正常</p>
                <p>4. 日志清理后不可恢复，请谨慎处理</p>
            </div>


        </div>
        <div class="buttons">
            <a class="closeW">取消</a>
            <a onclick="sureClean(this)">清理</a>
            
            <div class="clear"></div>
        </div>
    </div>
    <!-- 取消清理任务弹层 -->
    <div class="cancelCPop pop">
        <div class="title">停止清理<span class="closeW"></span></div>
        <div class="left"><img src="images/cancelC.png"></div>
        <div class="right">
            <p class="describe"><span class="verticalMiddle">确定要取消清理任务吗？ </span></p>
            <p class="describe">清理任务取消后将不再清理日志。</p>

        </div>
        <div class="clear"></div>
        <div class="buttons"><a onclick="hideButton(this)">取消</a><a onclick="cancelClean()" class="sure">确定</a></div>
    </div>
    <!-- 定时任务弹窗 -->
    <div class="tTPop pop">
    	<div class="windowShade absolute"></div>

    	<div class="title">定时任务<span class="closeW"></span></div>
    	<div class="taskParameters">
    		<p>
    		    <span class="heading verticalMiddle">选择分组 : </span>
    		    <select id="groupName" class="verticalMiddle">
    		    	<option value="">全网终端</option>
    		    </select>
    		    <span class="heading verticalMiddle">任务类型 : </span>
    		    <select id="typeName" class="verticalMiddle">
    		    	<option value="quick_scan">快速查杀</option>
    		    	<option value="full_scan">全盘查杀</option>
    		    	<option value="shutdown">关机任务</option>
    		    	<option value="reboot">重启任务</option>
    		    </select>
    		    <a class="underline verticalMiddle blackfont cursor" onclick="sKCPop(this)">设置</a>
    		</p>
    		<p>
    			<span class="heading verticalMiddle">任务时间 : </span>
    			<input type="" name="hour" class="verticalMiddle" onkeyup="value=value.replace(/[^\d]/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" value=00 maxlength="2">
    			<span class="verticalMiddle"> : </span>
    			<input type="" name="minute" class="verticalMiddle" onkeyup="value=value.replace(/[^\d]/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" value=00 maxlength="2">
    			<span class="heading verticalMiddle">任务频率 : </span>
    			<input type="radio" name="taskfre" value="daily" placeholder="" class="verticalMiddle cursor" checked>
    			<span class="verticalMiddle">每天</span>
    			<input type="radio" name="taskfre" value="weekly" placeholder="" class="verticalMiddle cursor">
    			<span class="verticalMiddle">每周</span>
    			<select name="week" class="verticalMiddle">
    				<option value=1>周一</option>
    				<option value=2>周二</option>
    				<option value=3>周三</option>
    				<option value=4>周四</option>
    				<option value=5>周五</option>
    				<option value=6>周六</option>
    				<option value=0>周日</option>
    			</select>
    			<input type="radio" name="taskfre" value="monthly" placeholder="" class="verticalMiddle cursor">
    			<span class="verticalMiddle">每月</span>
    			<select name="month" class="verticalMiddle">
    				<option value=1>1日</option>
    				<option value=2>2日</option>
    				<option value=3>3日</option>
    				<option value=4>4日</option>
    				<option value=5>5日</option>
    				<option value=6>6日</option>
    				<option value=7>7日</option>
    				<option value=8>8日</option>
    				<option value=9>9日</option>
    				<option value=10>10日</option>
    				<option value=11>11日</option>
    				<option value=12>12日</option>
    				<option value=13>13日</option>
    				<option value=14>14日</option>
    				<option value=15>15日</option>
    				<option value=16>16日</option>
    				<option value=17>17日</option>
    				<option value=18>18日</option>
    				<option value=19>19日</option>
    				<option value=20>20日</option>
    				<option value=21>21日</option>
    				<option value=22>22日</option>
    				<option value=23>23日</option>
    				<option value=24>24日</option>
    				<option value=25>25日</option>
    				<option value=26>26日</option>
    				<option value=27>27日</option>
    				<option value=28>28日</option>
    				<option value=29>29日</option>
    				<option value=30>30日</option>
    				<option value=31>31日</option>
    			</select>
    		</p>
    	</div>
    	<div class="operateButtons">
    		<a class="underline deleteSTB floatL" onclick="deleteTask(this)">删除所选</a>
    		<a class="underline addTB floatR cursor greenfont" onclick="createTask()">添加任务</a>
    		<div clas="clear"></div>
    	</div>
    	<div class="tTTableTh">
    		<table>
    			<tr>
    				<th width='5%'><input type="checkbox" name="" value="" onclick="selectAll(this)"></th>
    				<th width='22%'>分组</th>
    				<th width='22%'>任务类型</th>
    				<th width='22%'>任务频率</th>
    				<th width='22%'>任务时间</th>
    				<th width='7%'>操作</th>
    			</tr>
    		</table>
    	</div>
    	<div class="tTTable">
    		<table>
    			<tr id='tableAlign'>
    				<td width='5%'><input type="checkbox" name="" value=""></td>
    				<td width='22%'>分组</td>
    				<td width='22%'>任务类型</td>
    				<td width='22%'>任务频率</td>
    				<td width='22%'>任务时间</td>
    				<td width='7%'><a class="blackfont">操作</a></td>
    			</tr>
    			
    		</table>
    	</div>

    	<!-- 快速查杀参数设置弹层 -->
    	<div class="fastSKCPop windowPop">
			<div class="title">查杀设置<span class="closeWW"></span></div>
			<div class="content">
				<div class="setBlock">
	    			<h4>查杀速度</h4>
	    			<p>
	    				<input type="radio" name="scanOp" value="0">
	    				<span>常规扫描，不影响计算机性能</span>
	    			</p>
	    			<p>
	    			    <input type="radio" name="scanOp" value="1">
	    				<span>高速扫描，速度快但影响计算机性能</span>
	    			</p>
	    		</div>
	    		<div class="setBlock">
	    			<h4>系统修复设置</h4>
	    			<p>
	    				<input type="checkbox" name="repairSet">
	    				<span>扫描系统可修复项目</span>
	    			</p>

	    		</div>
	    		<div class="setBlock">
	    			<h4>发现病毒时</h4>
	    			<p>
	    				<input type="radio" name="isHandle" value="0">
	    				<span>自动处理病毒</span>
	    			</p>
	    			<p>
	    			    <input type="radio" name="isHandle" value="1">
	    				<span>暂不处理，仅计入查杀日志</span>
	    			</p>

	    		</div>
	    		<div class="setBlock setBlockLast">
	    			<h4>清除病毒后</h4>
	    			<p>
	    				<input type="checkbox" name="afterClear">
	    				<span>将病毒文件备份至终端隔离区</span>
	    			</p>
	    		</div>
    	    </div>
    		<div class="buttons">
    			<a class="recoverDefault greenBgButton">恢复默认设置</a>
				<a class="closeWW greenBgButton">取消</a>
				<a onclick="saveFastSKC(this)" class="greenBgButton">确定</a>
				
				<div class="clear"></div>
			</div>
		</div>
		<!-- 全盘查杀参数设置弹层 -->
		<div class="overallSKCPop windowPop">
			<div class="title">查杀设置<span class="closeWW"></span></div>
			<div class="content">
				<div class="setBlock">
	    			<h4>全盘查杀设置</h4>
	    			<p>
	    				<input type="checkbox" name="overallSet1">
	    				<span>深度查杀压缩包中的病毒木马，并自动跳过大于<input type="text" name="overallPara1">MB的压缩包</span>
	    			</p>
	    			<p>
	    				<span>提示：自定义扫描将自动扫描压缩包，并不受以上大小限制</span>
	    			</p>
	    			<p>
	    			    <input type="checkbox" name="overallSet2">
	    				<span>不扫描指定扩展名文件<input type="text" name="overallPara2"></span>
	    			</p>
	    		</div>
				<div class="setBlock">
	    			<h4>查杀速度</h4>
	    			<p>
	    				<input type="radio" name="scanOp" value="0">
	    				<span>常规扫描，不影响计算机性能</span>
	    			</p>
	    			<p>
	    			    <input type="radio" name="scanOp" value="1">
	    				<span>高速扫描，速度快但影响计算机性能</span>
	    			</p>
	    		</div>
	    		<div class="setBlock">
	    			<h4>系统修复设置</h4>
	    			<p>
	    				<input type="checkbox" name="repairSet">
	    				<span>扫描系统可修复项目</span>
	    			</p>

	    		</div>
	    		<div class="setBlock">
	    			<h4>发现病毒时</h4>
	    			<p>
	    				<input type="radio" name="isHandle" value="0">
	    				<span>自动处理病毒</span>
	    			</p>
	    			<p>
	    			    <input type="radio" name="isHandle" value="1">
	    				<span>暂不处理，仅计入查杀日志</span>
	    			</p>

	    		</div>
	    		<div class="setBlock setBlockLast">
	    			<h4>清除病毒后</h4>
	    			<p>
	    				<input type="checkbox" name="afterClear">
	    				<span>将病毒文件备份至终端隔离区</span>
	    			</p>
	    		</div>
    	    </div>
    		<div class="buttons">
    			<a class="recoverDefault">恢复默认设置</a>
				<a class="closeWW">取消</a>
				<a onclick="saveOverallSKC(this)">确定</a>
				
				<div class="clear"></div>
			</div>
		</div>
    </div>
    <div class="delayHide">
        <p class="p1"><img src="images/unusualw.png">请选择终端!</p>
    </div>
    <div class="delayHideS">
        <p class="p1"><img src="images/unusualw.png"></p>
    </div>
    <script src="js/lyz.calendar.min.cleanlog.js" type="text/javascript"></script>
    <script>
        //后退到当前页面将父页面选项卡置为当前位置
        parent.$(".nav .container a[name='terminalArrange.html']").addClass("current");
        parent.$(".nav .container a[name='terminalArrange.html']").siblings().removeClass("current");
		parent.$(".footer").show();

        document.cookie='page=terminalArrange.html';

		var detailnumperpage = 9;

        $("#cleanLogDate").val(GetDateStr(-6));
        //清理日志日期选择input
        $("#cleanLogDate").calendar({

            upperLimit: new Date(GetDateStr(-6))
        });
        //首页过来
        if(parent.$(".nav .container a").eq(4).attr("id")=="firstPage"){
            shade();
            $(".unSetRulePop").show();
            parent.$(".nav .container a").eq(4).removeAttr("id");

        }
        function goImmediately(a){
            $(a).parent().parent().hide();
            parent.$(".systemSB").click();
            parent.$(".systemSPop .pageTab").removeClass("current");
            parent.$(".systemSPop .pageTab").eq(2).addClass("current");
            parent.$(".systemSPop .page").hide();
            parent.$(".systemSPop .page").eq(2).show();
            $(".shade").hide();
            parent.$(".shade").show();
        }
        //终端部署设置地址内容改变
        $("#addressContent").change(function(){
            if($(this).val()==0){
                $(this).next().show();
                $(this).next().next().show();
            }else{
                $(this).next().hide();
                $(this).next().next().hide();
            }
        })
        //终端部署中公告内容长度限制
        $("#noticeContent").keyup(function(){
            if($(this).val().length>120){
                $(this).val($(this).val().substr(0,120));
            }
        })
        //x关闭弹层
        $(".closeW").click(function(){
            $(".shade").hide();
            parent.$(".topshade").hide();
            $(this).parent().parent().hide();
        });
        $(".closeWW,.hiddenButton").click(function(event) {
        	$(this).parents(".windowPop").hide();
        	$(this).parents(".pop").find(".windowShade").hide();
        });
        //关闭遮罩和弹窗
        function hideButton(a){
            $(".shade").hide();
            parent.$(".topshade").hide();
            $(a).parents(".pop").hide();
        }
        
        function terminalASPop(){
            shade();
            $(".terminalASPop").show();
            $(".terminalASPop .content .unusualTxt").hide();
            var ip="";
            $.ajax({
                url:'/mgr/sysconf/_deploy',
                data:{},
                type:'GET',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
                success:function(data){
                    $("#noticeTitle").val(data.data.title);
                    $("#noticeContent").val(data.data.content);
                    ip=data.data.addr;

                }
            });
            $.ajax({
                url:'/mgr/sysconf/_iplist',
                data:{},
                type:'GET',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
                success:function(data){
                    var list=data.data.list;
                    var iplist="";
                    
                    if(isInArray(list,ip)==false){
                        for (var i = 0; i < list.length; i++) { 
                            iplist+="<option>"+list[i]+"</option>";       
                        }
                        iplist+="<option value=0 selected>自定义域名</option>";
                        $("#addressContent").next().show();
                        $("#addressContent").next().next().show();
                        $("#addressContent").next().next().val(ip);
                    }else{
                        for (var i = 0; i < list.length; i++) {
                            if(list[i]==ip){
                                iplist+="<option selected>"+list[i]+"</option>";
                            }else{
                                iplist+="<option>"+list[i]+"</option>";    
                            }
                            
                        }
                        iplist+="<option value=0>自定义域名</option>";
                    }
                    
                    $("#addressContent").html(iplist);


                }
            });


        }
        function submitTASet(a){
            var noticetitle=$("#noticeTitle").val();
            var noticecontent=$("#noticeContent").val();
            if($("#addressContent").val()==0){
                var diyaddress=$("#port").val();
                var dataa={"title":noticetitle,"content":noticecontent,"addr":diyaddress};
            }else{
                var addresscontent=$("#addressContent").val();
                var dataa={"title":noticetitle,"content":noticecontent,"addr":addresscontent};
            }
            
            $.ajax({
                url:'/mgr/deploy/_update',
                data:JSON.stringify(dataa),
                type:'POST',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
                success:function(data){
                    hideButton(a);
                    tAAjax();
                }
            });


        }
         function copyUrl(a){
            $(".copyUrl").show();
            var url=$(a).parent().next();
            url.select(); 
            document.execCommand("Copy"); 
            $(".copyUrl").hide();
        }

        //载入页面清理日志状态
        // 读取清理日志状态定时器
        cleanLS();
        // var cleanls=setInterval(function(){cleanLS()},500)
        function cleanLS(){
            $.ajax({
                url:'/mgr/cleanlog/_query',
                data:{},
                type:'GET',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
                error:function(xhr,textStatus,errorThrown){
		        	if(xhr.status==401){
		        	    parent.window.location.href='/';
		        	}else{
		        		
		        	}
		            
		        },
                success:function(data){
                    if(data.errno==0){
                        if(data.status==1){
                            $("#haveCleanS a").remove();
                            $("#haveCleanS").append("<a style='line-height:40px;height:40px;vertical-align:middle;margin-left:20px;'>正在执行</a>");
                            $("#haveCleanS span").html("清理日志任务：将会在最近的 "+data.data.task.hour+" 点清理  "+getLocalTime3(data.data.task.end)+"  之前的所有日志");
                            $("#haveCleanS").show();
                            $("#lCTool").find(".absoluteTxt").removeClass("cleanL");
                            $("#cleanLogDate").val(getLocalTime3(data.data.task.end));
                            $("#cleanLogTime").val(data.data.task.hour);
                            $(".cleanLogPop .buttons a").eq(1).html("正在清理");
                            $(".cleanLogPop .buttons a").eq(1).attr("onclick",""); 
                            $(".cleanLogPop .buttons a").eq(1).css({background:'rgb(200,200,200)'}); 
                            $("#cleanLogDate").prop("disabled",true);
                            $("#cleanLogTime").prop("disabled",true);
                            clearInterval(cleanls);

                        }else{
                            $("#haveCleanS span").html("清理日志任务：将会在最近的 "+data.data.task.hour+" 点清理  "+getLocalTime3(data.data.task.end)+"  之前的所有日志");
                            $("#haveCleanS").show();
                            $("#lCTool").eq(0).find(".absoluteTxt").removeClass("cleanL");
                            $("#cleanLogDate").val(getLocalTime3(data.data.task.end));
                            $("#cleanLogTime").val(data.data.task.hour);
                            $(".cleanLogPop .buttons a").eq(1).html("停止清理");
                            $(".cleanLogPop .buttons a").eq(1).attr("onclick","cancelClean()"); 
                            $("#cleanLogDate").prop("disabled",true);
                            $("#cleanLogTime").prop("disabled",true);
                        }
                        
                
                    }else{
                        $("#lCTool").eq(0).find(".absoluteTxt").addClass("cleanL");
                    }
                    

                    
                }
            });  
        }
        
        //清理日志弹层
        $(".cleanLButton").click(function(){
            shade();
            $(".cleanLogPop").show();

        })
        //清理按钮
        function sureClean(a){
            
            var end=getBeginTimes($("#cleanLogDate").val());
            var hour=parseInt($("#cleanLogTime").val());

            if(end>(getBeginTimes(GetDateStr(-6)))){
                $(".delayHide").show();
                $(".delayHide .p1").html("<img src='images/unusualw.png' class='verticalMiddle'><span class='verticalMiddle'> 只能选择"+GetDateStr(-5)+"以前的日期</span>");
                setTimeout(function(){$(".delayHide").hide()},2000);  
            }else{
                var dataa={"hour":hour,"end":end};
                $.ajax({
                    url:'/mgr/cleanlog/_create',
                    data:JSON.stringify(dataa),
                    type:'POST',
					contentType:'text/plain',
					headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
                    error:function(xhr,textStatus,errorThrown){
						if(xhr.status==401){
			        	    parent.window.location.href='/';
			        	}else{
			        		
			        	}
					},
                    success:function(data){
                        $("#haveCleanS").show();
                        $("#lCTool").find(".absoluteTxt").removeClass("cleanL");
                        $("#haveCleanS span").html("清理日志任务：将会在最近的 "+hour+" 点清理  "+$("#cleanLogDate").val()+"  之前的所有日志");
                        $(a).html("停止清理");
                        $(a).attr("onclick","cancelClean()");
                        $("#cleanLogDate").prop("disabled",true);
                        $("#cleanLogTime").prop("disabled",true); 

                        $(".cleanLogPop").hide();
                        $(".shade").hide();
                        parent.$(".topshade").hide();

                        $(".delayHideS").show();
                        $(".delayHideS .p1").html("<img src='images/success.png' class='verticalMiddle'><span class='verticalMiddle'> 操作成功</span>");
                        setTimeout(function(){$(".delayHideS").hide()},2000);
                    }
                }); 
            }
            

        }
        //停止清理
        function cancelClean(){
            $.ajax({
                url:'/mgr/cleanlog/_cancel',
                data:{},
                type:'GET',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
                error:function(xhr,textStatus,errorThrown){
					if(xhr.status==401){
		        	    parent.window.location.href='/';
		        	}else{
		        		
		        	}
				},
                success:function(data){
                    $("#haveCleanS").hide();
                    $("#lCTool").find(".absoluteTxt").addClass("cleanL");
                    $(".cleanLogPop .buttons a").eq(1).html("清理");
                    $(".cleanLogPop .buttons a").eq(1).attr("onclick","sureClean(this)"); 
                    $("#cleanLogDate").prop("disabled",false);
                    $("#cleanLogTime").prop("disabled",false);
                    $(".delayHideS").show();
                    $(".delayHideS .p1").html("<img src='images/success.png' class='verticalMiddle'><span class='verticalMiddle'> 操作成功</span>");
                    setTimeout(function(){$(".delayHideS").hide()},2000); 
                    if($(".cancelCPop").is(":hidden")){
                        $(".cleanLogPop").hide();
                        $(".shade").hide();
                        parent.$(".topshade").hide();
                    }else{
                        $(".cancelCPop").hide();
                        $(".shade").hide();
                        parent.$(".topshade").hide();
                    }
                }
            });
        }
        // 确认清理日志弹层
        function cancelCPop(){
            $(".cancelCPop").show();
            shade();
        }
        // 读取日志大小
        $.ajax({
            url:'/mgr/log/_stat',
            data:{},
            type:'GET',
			contentType:'text/plain',
			headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
            success:function(data){
                if(data.data.log_size<1048576){
                  $("#lognum").html(round(data.data.log_size/1024,1)+"K");  
                }else if(data.data.log_size>=1048576 && data.data.log_size<1073741824){
                    $("#lognum").html(round((data.data.log_size)/1048576,1)+"M")
                }else if(data.data.log_size>=1073741824 && data.data.log_size<1099511627776){
                    $("#lognum").html(round((data.data.log_size)/1073741824,1)+"G")
                }else if(data.data.log_size>=1099511627776){
                    $("#lognum").html(round((data.data.log_size)/1099511627776,1)+"T")
                }
                
            }
        });
        $(".pop").on("change",".select,th input[type=checkbox]",function(){
		    if($(this).parents(".pop").find(".select:checked").length>0){
		        $(this).parents(".pop").find(".deleteSTB").addClass("greenfont");
		        $(this).parents(".pop").find(".deleteSTB").addClass("cursor");
		    }else{
		        $(this).parents(".pop").find(".deleteSTB").removeClass("greenfont");
		        $(this).parents(".pop").find(".deleteSTB").removeClass("cursor");
		    }
		})

        // 定时任务弹层
        // 
        $("input[name='hour'],input[name='minute']").blur(function(){
            if($(this).val().length==1){
                $(this).val(0+$(this).val());
            }
        })
        var fastskc="";//快速查杀参数设置
        var fastskcdefault="";//快速查杀默认参数设置
        var overallskc="";//快速查杀参数设置
        var overallskcdefault="";//快速查杀默认参数设置
        $.ajax({
            url:'/mgr/group/_dict',
            data:{},
            type:'GET',
			contentType:'text/plain',
			headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
            success:function(data){
            	var list=data.data.list;
            	var select="";
            	select+="<option value=0>全网终端</option>";
			    for (var i = 0; i < list.length; i++) {
			        select+="<option value="+list[i].group_id+">"+safeStr(list[i].group_name)+"</option>"	
			    }
			    $("#groupName").html(select);
			    
            }
        });
        $(".tTButton").click(function(){
        	$(".tTPop").show();
        	shade();
        	taskAjax();
	        //取快速设置的默认设置参数
	        $.ajax({
				url:'/mgr/task/_param?type=quick_scan',
				data:{},
				type:'GET',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
				success:function(data){

					var data=data.data.data;
					var first=data['scan.maxspeed'];
					var second=data['scan.sysrepair'];
					var third=data['clean.automate'];
					var fourth=data['clean.quarantine'];
					fastskc={"scan.maxspeed":first,"scan.sysrepair":second,"clean.automate":third,"clean.quarantine":fourth};
					fastskcdefault=fastskc;//保存默认设置参数
					if(first==true){
						$(".fastSKCPop input[name=scanOp]").eq(1).prop("checked",true);
						$(".fastSKCPop input[name=scanOp]").eq(0).prop("checked",false);

					}else if(first==false){
						$(".fastSKCPop input[name=scanOp]").eq(0).prop("checked",true);
						$(".fastSKCPop input[name=scanOp]").eq(1).prop("checked",false);
					}
					if(second==true){
						$(".fastSKCPop input[name=repairSet]").prop("checked",true);
					}else{
						$(".fastSKCPop input[name=repairSet]").prop("checked",false);

					}
					if(third==true){
						$(".fastSKCPop input[name=isHandle]").eq(0).prop("checked",true);
						$(".fastSKCPop input[name=isHandle]").eq(1).prop("checked",false)
					}else if(third==false){
						$(".fastSKCPop input[name=isHandle]").eq(1).prop("checked",true);
						$(".fastSKCPop input[name=isHandle]").eq(0).prop("checked",false)
					}
					if(fourth==true){
						$(".fastSKCPop input[name=afterClear]").prop("checked",true)
					}else{
						$(".fastSKCPop input[name=afterClear]").prop("checked",false)
					}   
				}
	        });
	        $.ajax({
				url:'/mgr/task/_param?type=full_scan',
				data:{},
				type:'GET',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
				success:function(data){

					var data=data.data.data;
					var first=data['scan.maxspeed'];
					var second=data['scan.sysrepair'];
					var third=data['clean.automate'];
					var fourth=data['clean.quarantine'];
					var overallpara1=data['decompo.limit.size'].enable;
                    var overallpara2=data['scan.exclusion.ext'].enable;
					var overallpara1V=data['decompo.limit.size'].value;
                    var overallpara2V=data['scan.exclusion.ext'].value;
					overallskc={"scan.maxspeed":first,"scan.sysrepair":second,"clean.automate":third,"clean.quarantine":fourth,"decompo.limit.size":{"enable":overallpara1,"value":overallpara1V},"scan.exclusion.ext":{"enable":overallpara2,"value":overallpara2V}};
					overallskcdefault=overallskc;
					if(first==true){
						$(".overallSKCPop input[name=scanOp]").eq(1).prop("checked",true);
						$(".overallSKCPop input[name=scanOp]").eq(0).prop("checked",false);
					}else{
						$(".overallSKCPop input[name=scanOp]").eq(0).prop("checked",true);
						$(".overallSKCPop input[name=scanOp]").eq(1).prop("checked",false);
					}
					if(second==true){
						$(".overallSKCPop input[name=repairSet]").prop("checked",true)
					}else{
						$(".overallSKCPop input[name=repairSet]").prop("checked",false)
					}
					if(third==true){
						$(".overallSKCPop input[name=isHandle]").eq(0).prop("checked",true);
						$(".overallSKCPop input[name=isHandle]").eq(1).prop("checked",false);
					}else{
						$(".overallSKCPop input[name=isHandle]").eq(1).prop("checked",true);
						$(".overallSKCPop input[name=isHandle]").eq(0).prop("checked",false);
					}
					if(fourth==true){
						$(".overallSKCPop input[name=afterClear]").prop("checked",true)
					}else{
						$(".overallSKCPop input[name=afterClear]").prop("checked",false)
					}

					if(overallpara1==true){
						$(".overallSKCPop input[name=overallSet1]").prop("checked",true);
						$(".overallSKCPop input[name=overallPara1]").val(overallpara1V);
					}else{
						$(".overallSKCPop input[name=overallSet1]").prop("checked",false);
						$(".overallSKCPop input[name=overallPara1]").val(overallpara1V);
						$(".overallSKCPop input[name=overallPara1]").prop("disabled",true)
					}
					if(overallpara2==true){
						$(".overallSKCPop input[name=overallSet2]").prop("checked",true);
						$(".overallSKCPop input[name=overallPara2]").val(overallpara2V);
					}else{
						$(".overallSKCPop input[name=overallSet2]").prop("checked",false);
						$(".overallSKCPop input[name=overallPara2]").val(overallpara2V);
						$(".overallSKCPop input[name=overallPara2]").prop("disabled",true)
					}

                   
                    
					
				}
	        });
        })
        function taskAjax(start){
			
			var begin = arguments[0] ? arguments[0] : 0;
			var dataa = {"view":{"begin":begin,"count":detailnumperpage}};
        	$.ajax({
	            url:'/mgr/schedule/_list',
	            data:JSON.stringify(dataa),
	            type:'POST',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
	            success:function(data){
					var list=data.data.list;
					var totalnum = data.data.view.total;
					var pages = Math.ceil(totalnum / detailnumperpage);
	            	var table="";
	            	table+="<tr id='tableAlign'>";
    				table+="<td width='5%'><input type='checkbox' name='' value=''></td>";
    				table+="<td width='22%'>分组</td>";
    				table+="<td width='22%'>任务类型</td>";
    				table+="<td width='22%'>任务频率</td>";
    				table+="<td width='22%'>任务时间</td>";
    				table+="<td width='7%'><a class='blackfont'>操作</a></td>";
    			    table+="</tr>";
    			    for (var i = 0; i < list.length; i++) {
    			    	table+="<tr taskid="+list[i].schedule_id+">";
	    				table+="<td><input type='checkbox' name='' value='' class='select'></td>";
	    				if(list[i].group_name==""){
	    					table+="<td>全网终端</td>";
	    				}else{
	    					table+="<td>"+safeStr(list[i].group_name)+"</td>";
	    				}
	    				
	    				if(list[i].task_type=="quick_scan"){
	    					table+="<td>快速查杀</td>";
	    				}else if(list[i].task_type=="full_scan"){
	    					table+="<td>全盘查杀</td>";
	    				}else if(list[i].task_type=="shutdown"){
	    					table+="<td>关机</td>";
	    				}else if(list[i].task_type=="reboot"){
	    					table+="<td>重启</td>";
	    				}
	    				if(list[i].cycle_type=="daily"){
	    					table+="<td>每天</td>";
	    				}else if(list[i].cycle_type=="weekly"&&list[i].cycle_value==0){
	    					table+="<td>每周日</td>";
	    				}else if(list[i].cycle_type=="weekly"&&list[i].cycle_value==1){
	    					table+="<td>每周一</td>";
	    				}else if(list[i].cycle_type=="weekly"&&list[i].cycle_value==2){
	    					table+="<td>每周二</td>";
	    				}else if(list[i].cycle_type=="weekly"&&list[i].cycle_value==3){
	    					table+="<td>每周三</td>";
	    				}else if(list[i].cycle_type=="weekly"&&list[i].cycle_value==4){
	    					table+="<td>每周四</td>";
	    				}else if(list[i].cycle_type=="weekly"&&list[i].cycle_value==5){
	    					table+="<td>每周五</td>";
	    				}else if(list[i].cycle_type=="weekly"&&list[i].cycle_value==6){
	    					table+="<td>每周六</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==1){
	    					table+="<td>每月一号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==2){
	    					table+="<td>每月二号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==3){
	    					table+="<td>每月三号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==4){
	    					table+="<td>每月四号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==5){
	    					table+="<td>每月五号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==6){
	    					table+="<td>每月六号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==7){
	    					table+="<td>每月七号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==8){
	    					table+="<td>每月八号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==9){
	    					table+="<td>每月九号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==10){
	    					table+="<td>每月十号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==11){
	    					table+="<td>每月十一号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==12){
	    					table+="<td>每月十二号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==13){
	    					table+="<td>每月十三号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==14){
	    					table+="<td>每月十四号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==15){
	    					table+="<td>每月十五号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==16){
	    					table+="<td>每月十六号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==17){
	    					table+="<td>每月十七号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==18){
	    					table+="<td>每月十八号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==19){
	    					table+="<td>每月十九号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==20){
	    					table+="<td>每月二十号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==21){
	    					table+="<td>每月二十一号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==22){
	    					table+="<td>每月二十二号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==23){
	    					table+="<td>每月二十三号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==24){
	    					table+="<td>每月二十四号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==25){
	    					table+="<td>每月二十五号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==26){
	    					table+="<td>每月二十六号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==27){
	    					table+="<td>每月二十七号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==28){
	    					table+="<td>每月二十八号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==29){
	    					table+="<td>每月二十九号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==30){
	    					table+="<td>每月三十号</td>";
	    				}else if(list[i].cycle_type=="monthly"&&list[i].cycle_value==31){
	    					table+="<td>每月三十一号</td>";
	    				}
	    				if(list[i].time_hour.toString().length==1){
	    					table+="<td>0"+list[i].time_hour+":";
	    				}else{
	    					table+="<td>"+list[i].time_hour+":";
						}
						
	    				if(list[i].time_minute.toString().length==1){
	    					table+="0"+list[i].time_minute+"</td>";
	    				}else{
	    					table+=list[i].time_minute+"</td>";
	    				}
	    				table+="<td><a class='blackfont underline blackfont cursor' onclick='deleteTask(this)'>删除</a></td>";
	    			    table+="</tr>";
    			    }
					$(".tTTable table").html(table);
					$('.tTPop .pageBox').remove();
					$(".tTPop").append("<div class='pageBox'><a style='font-size:12px;color:#6a6c6e;line-height:54px;padding-left:20px;float:left;' class='totalPages'>共 " + totalnum + " 条记录</a><div class='tcdPageCode' style='font-size:12px;float:right;padding-top:14px;padding-bottom:14px;padding-right:20px;'></div><div class='clear clearfloat'></div></div>");
					var current = (dataa.view.begin/dataa.view.count) + 1;
					$(".tTPop .tcdPageCode").createPage({
						pageCount: pages,
						current: parseInt(current),
						backFn: function(pageIndex) {
							start = (pageIndex - 1) * detailnumperpage;
							taskAjax(start); 
						}
					})
				}
	        });
        }
        // 任务类型select显示隐藏设置按钮
        $("#typeName").change(function(){
        	if($(this).val()=="quick_scan"||$(this).val()=="full_scan"){
        		$(this).next().show();
        	}else{
        		$(this).next().hide();
        	}
        })
        // 快速查杀和全盘查杀参数设置弹层
        function sKCPop(self){
        	if($("#typeName").val()=="quick_scan"){
        		$(".fastSKCPop").show();
        		$(".tTPop .windowShade").show();
        		var first=fastskc['scan.maxspeed'];
				var second=fastskc['scan.sysrepair'];
				var third=fastskc['clean.automate'];
				var fourth=fastskc['clean.quarantine'];
				if(first==true){
					$(".fastSKCPop input[name=scanOp]").eq(1).prop("checked",true);
					$(".fastSKCPop input[name=scanOp]").eq(0).prop("checked",false);

				}else if(first==false){
					$(".fastSKCPop input[name=scanOp]").eq(0).prop("checked",true);
					$(".fastSKCPop input[name=scanOp]").eq(1).prop("checked",false);
				}
				if(second==true){
					$(".fastSKCPop input[name=repairSet]").prop("checked",true);
				}else{
					$(".fastSKCPop input[name=repairSet]").prop("checked",false);

				}
				if(third==true){
					$(".fastSKCPop input[name=isHandle]").eq(0).prop("checked",true);
					$(".fastSKCPop input[name=isHandle]").eq(1).prop("checked",false)
				}else if(third==false){
					$(".fastSKCPop input[name=isHandle]").eq(1).prop("checked",true);
					$(".fastSKCPop input[name=isHandle]").eq(0).prop("checked",false)
				}
				if(fourth==true){
					$(".fastSKCPop input[name=afterClear]").prop("checked",true)
				}else{
					$(".fastSKCPop input[name=afterClear]").prop("checked",false)
				}
        	}else{
        		$(".overallSKCPop").show();
        		$(".tTPop .windowShade").show();
        		var first=overallskc['scan.maxspeed'];
				var second=overallskc['scan.sysrepair'];
				var third=overallskc['clean.automate'];
				var fourth=overallskc['clean.quarantine'];
				var overallpara1=overallskc['decompo.limit.size'].enable;
	            var overallpara2=overallskc['scan.exclusion.ext'].enable;
				var overallpara1V=overallskc['decompo.limit.size'].value;
	            var overallpara2V=overallskc['scan.exclusion.ext'].value;
				if(first==true){
					$(".overallSKCPop input[name=scanOp]").eq(1).prop("checked",true);
					$(".overallSKCPop input[name=scanOp]").eq(0).prop("checked",false);
				}else{
					$(".overallSKCPop input[name=scanOp]").eq(0).prop("checked",true);
					$(".overallSKCPop input[name=scanOp]").eq(1).prop("checked",false);
				}
				if(second==true){
					$(".overallSKCPop input[name=repairSet]").prop("checked",true)
				}else{
					$(".overallSKCPop input[name=repairSet]").prop("checked",false)
				}
				if(third==true){
					$(".overallSKCPop input[name=isHandle]").eq(0).prop("checked",true);
					$(".overallSKCPop input[name=isHandle]").eq(1).prop("checked",false);
				}else{
					$(".overallSKCPop input[name=isHandle]").eq(1).prop("checked",true);
					$(".overallSKCPop input[name=isHandle]").eq(0).prop("checked",false);
				}
				if(fourth==true){
					$(".overallSKCPop input[name=afterClear]").prop("checked",true)
				}else{
					$(".overallSKCPop input[name=afterClear]").prop("checked",false)
				}

				if(overallpara1==true){
					$(".overallSKCPop input[name=overallSet1]").prop("checked",true);
					$(".overallSKCPop input[name=overallPara1]").val(overallpara1V);
				}else{
					$(".overallSKCPop input[name=overallSet1]").prop("checked",false);
					$(".overallSKCPop input[name=overallPara1]").val(overallpara1V);
					$(".overallSKCPop input[name=overallPara1]").prop("disabled",true)
				}
				if(overallpara2==true){
					$(".overallSKCPop input[name=overallSet2]").prop("checked",true);
					$(".overallSKCPop input[name=overallPara2]").val(overallpara2V);
				}else{
					$(".overallSKCPop input[name=overallSet2]").prop("checked",false);
					$(".overallSKCPop input[name=overallPara2]").val(overallpara2V);
					$(".overallSKCPop input[name=overallPara2]").prop("disabled",true)
				}
        	}
        }
        // 快速查杀参数恢复默认参数
        $(".fastSKCPop .recoverDefault").click(function(){
        	var first=fastskcdefault['scan.maxspeed'];
			var second=fastskcdefault['scan.sysrepair'];
			var third=fastskcdefault['clean.automate'];
			var fourth=fastskcdefault['clean.quarantine'];
			if(first==true){
				$(".fastSKCPop input[name=scanOp]").eq(1).prop("checked",true);
				$(".fastSKCPop input[name=scanOp]").eq(0).prop("checked",false);

			}else if(first==false){
				$(".fastSKCPop input[name=scanOp]").eq(0).prop("checked",true);
				$(".fastSKCPop input[name=scanOp]").eq(1).prop("checked",false);
			}
			if(second==true){
				$(".fastSKCPop input[name=repairSet]").prop("checked",true);
			}else{
				$(".fastSKCPop input[name=repairSet]").prop("checked",false);

			}
			if(third==true){
				$(".fastSKCPop input[name=isHandle]").eq(0).prop("checked",true);
				$(".fastSKCPop input[name=isHandle]").eq(1).prop("checked",false)
			}else if(third==false){
				$(".fastSKCPop input[name=isHandle]").eq(1).prop("checked",true);
				$(".fastSKCPop input[name=isHandle]").eq(0).prop("checked",false)
			}
			if(fourth==true){
				$(".fastSKCPop input[name=afterClear]").prop("checked",true)
			}else{
				$(".fastSKCPop input[name=afterClear]").prop("checked",false)
			}

        })
        function saveFastSKC(a){
        	
        	if($(a).parents(".pop").find("input[name=scanOp]:checked").val()==1){
        		var first=true;
        	}else{
        		var first=false;
        	}
        	if($(a).parents(".pop").find("input[name=repairSet]").prop("checked")==true){
        		var second=true;
        	}else{
        		var second=false;
        	}
        	if($(a).parents(".pop").find("input[name=isHandle]:checked").val()==0){
        		var third=true;
        	}else{
        		var third=false;
        	}
        	if($(a).parents(".pop").find("input[name=afterClear]").prop("checked")==true){
        		var fourth=true;
        	}else{
        		var fourth=false;
        	}

        	fastskc={"scan.maxspeed":first,"scan.sysrepair":second,"clean.automate":third,"clean.quarantine":fourth};

        	$(a).parents(".windowPop").hide();
        	$(a).parents(".windowPop").siblings(".windowShade").hide();

        }
        // 全盘查杀参数恢复默认参数
        $(".overallSKCPop .recoverDefault").click(function(){
        	var first=overallskcdefault['scan.maxspeed'];
			var second=overallskcdefault['scan.sysrepair'];
			var third=overallskcdefault['clean.automate'];
			var fourth=overallskcdefault['clean.quarantine'];
			var overallpara1=overallskcdefault['decompo.limit.size'].enable;
            var overallpara2=overallskcdefault['scan.exclusion.ext'].enable;
			var overallpara1V=overallskcdefault['decompo.limit.size'].value;
            var overallpara2V=overallskcdefault['scan.exclusion.ext'].value;
			if(first==true){
				$(".overallSKCPop input[name=scanOp]").eq(1).prop("checked",true);
				$(".overallSKCPop input[name=scanOp]").eq(0).prop("checked",false);
			}else{
				$(".overallSKCPop input[name=scanOp]").eq(0).prop("checked",true);
				$(".overallSKCPop input[name=scanOp]").eq(1).prop("checked",false);
			}
			if(second==true){
				$(".overallSKCPop input[name=repairSet]").prop("checked",true)
			}else{
				$(".overallSKCPop input[name=repairSet]").prop("checked",false)
			}
			if(third==true){
				$(".overallSKCPop input[name=isHandle]").eq(0).prop("checked",true);
				$(".overallSKCPop input[name=isHandle]").eq(1).prop("checked",false);
			}else{
				$(".overallSKCPop input[name=isHandle]").eq(1).prop("checked",true);
				$(".overallSKCPop input[name=isHandle]").eq(0).prop("checked",false);
			}
			if(fourth==true){
				$(".overallSKCPop input[name=afterClear]").prop("checked",true)
			}else{
				$(".overallSKCPop input[name=afterClear]").prop("checked",false)
			}

			if(overallpara1==true){
				$(".overallSKCPop input[name=overallSet1]").prop("checked",true);
				$(".overallSKCPop input[name=overallPara1]").val(overallpara1V);
			}else{
				$(".overallSKCPop input[name=overallSet1]").prop("checked",false);
			}
			if(overallpara2==true){
				$(".overallSKCPop input[name=overallSet2]").prop("checked",true);
				$(".overallSKCPop input[name=overallPara2]").val(overallpara2V);
			}else{
				$(".overallSKCPop input[name=overallSet2]").prop("checked",false);
			}

        })
        function saveOverallSKC(a){
        	
        	if($(a).parents(".pop").find("input[name=scanOp]:checked").val()==1){
        		var first=true;
        	}else{
        		var first=false;
        	}
        	if($(a).parents(".pop").find("input[name=repairSet]").prop("checked")==true){
        		var second=true;
        	}else{
        		var second=false;
        	}
        	if($(a).parents(".pop").find("input[name=isHandle]:checked").val()==0){
        		var third=true;
        	}else{
        		var third=false;
        	}
        	if($(a).parents(".pop").find("input[name=afterClear]").prop("checked")==true){
        		var fourth=true;
        	}else{
        		var fourth=false;
        	}
            var overallpara1=$("input[name=overallPara1]").val();
            var overallpara2=$("input[name=overallPara2]").val();
            if($(a).parents(".pop").find("input[name=overallSet1]").prop("checked")==true && $(a).parents(".pop").find("input[name=overallSet2]").prop("checked")==true){
            	overallskc={"scan.maxspeed":first,"scan.sysrepair":second,"clean.automate":third,"clean.quarantine":fourth,"decompo.limit.size":{"enable":true,"value":overallpara1},"scan.exclusion.ext":{"enable":true,"value":overallpara2}};
            }else if($(a).parents(".pop").find("input[name=overallSet1]").prop("checked")==true && $(a).parents(".pop").find("input[name=overallSet2]").prop("checked")==false){
            	overallskc={"scan.maxspeed":first,"scan.sysrepair":second,"clean.automate":third,"clean.quarantine":fourth,"decompo.limit.size":{"enable":true,"value":overallpara1},"scan.exclusion.ext":{"enable":false}};
            }else if($(a).parents(".pop").find("input[name=overallSet1]").prop("checked")==false && $(a).parents(".pop").find("input[name=overallSet2]").prop("checked")==true){
            	overallskc={"scan.maxspeed":first,"scan.sysrepair":second,"clean.automate":third,"clean.quarantine":fourth,"decompo.limit.size":{"enable":false},"scan.exclusion.ext":{"enable":true,"value":overallpara2}};

            }else if($(a).parents(".pop").find("input[name=overallSet1]").prop("checked")==false && $(a).parents(".pop").find("input[name=overallSet2]").prop("checked")==false){
            	overallskc={"scan.maxspeed":first,"scan.sysrepair":second,"clean.automate":third,"clean.quarantine":fourth,"decompo.limit.size":{"enable":false},"scan.exclusion.ext":{"enable":false}};

            }

        	$(a).parents(".windowPop").hide();
        	$(a).parents(".windowPop").siblings(".windowShade").hide();

        }
        // 限制任务时间输入
        $("input[name='hour']").keyup(function(){
        	if($(this).val()>23){
        		$(this).val(23);
        	}
        })
        $("input[name='minute']").keyup(function(){
        	if($(this).val()>59){
        		$(this).val(59);
        	}
        })
        // 创建任务
        //全盘查杀设置参数多选改变后面inpu状态
		$(".overallSKCPop input[name=overallSet1],.overallSKCPop input[name=overallSet2]").change(function(){
			if($(this).is(":checked")){
				$(this).next().find("input").prop("disabled",false);
			}else{
				$(this).next().find("input").prop("disabled",true);
			}
		})
        function createTask(){
        	var group_id=parseInt($("#groupName").val());
        	var task_type=$("#typeName").val();
        	if($("#typeName").val()=="quick_scan"){
        		var task_param=fastskc;
        	}else if($("#typeName").val()=="full_scan"){
        		var task_param=overallskc;
        	}else if($("#typeName").val()=="shutdown"||$("#typeName").val()=="reboot"){
        		var task_param={"tickcnt":60};
        	}
        	var cycle_type=$("input[name='taskfre']:checked").val();
        	if(cycle_type=="daily"){
        		var cycle_value=0;
        	}else if(cycle_type=="weekly"){
        		var cycle_value=parseInt($("select[name='week']").val());
        	}else{
        		var cycle_value=parseInt($("select[name='month']").val());
			}
			
        	var time_hour=parseInt($("input[name='hour']").val(), 10);
        	var time_minute=parseInt($("input[name='minute']").val(), 10);
        	var request_param={"group_id":group_id,"task_type":task_type,"task_param":task_param,"cycle_type":cycle_type,"cycle_value":cycle_value,"time_hour":time_hour,"time_minute":time_minute};
        	
        	$.ajax({
				url:'/mgr/schedule/_create',
				data:JSON.stringify(request_param),
				type:'POST',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
				error:function(xhr,textStatus,errorThrown){
					if(xhr.status==401){
		        	    parent.window.location.href='/';
		        	}else{
		        		
		        	}
				},
				success:function(data){
					if(data.errno==-1&&data.errmsg.indexOf("Invalid Parameter")!==-1){
						$(".delayHide").show();
                        $(".delayHide .p1").html("<img src='images/unusual.png' class='verticalMiddle'><span class='verticalMiddle'> 已存在相同任务</span>");
                        setTimeout(function(){$(".delayHide").hide()},2000);
					}else{
						taskAjax();// 刷新任务列表
					}
					
		        }
		    })
        }
        
        // 删除任务
        function deleteTask(self){
        	var request_param=[];
        	if($(self).parent().attr("class")=="operateButtons"){
        		$(".tTTable table tr input:checked").each(function(index){
	        		request_param.push(parseInt($(this).parents("tr").attr("taskid")));
	        	})
        	}else{
        		request_param.push(parseInt($(self).parents("tr").attr("taskid")));
        	}
        	
        	$.ajax({
				url:'/mgr/schedule/_delete',
				data:JSON.stringify(request_param),
				type:'POST',
				contentType:'text/plain',
				headers: {"HTTP_CSRF_TOKEN": getCookie('HRESSCSRF')},
				success:function(data){
					taskAjax();// 刷新任务列表
					$(".tTTableTh input").prop("checked",false);
					$(".deleteSTB").removeClass("greenfont").removeClass('cursor');
		        }
		    })
        }
        //调整页面内元素高度
        var mainlefth=parent.$("#iframe #mainFrame").height();

		$(".main .table").css({height:mainlefth});

        window.onresize = function(){
            var mainlefth=parent.$("#iframe #mainFrame").height();

            $(".main .table").css({height:mainlefth});

        }
        // 隐藏左边滚动条   
        // $(function(){
        //     $(".bgContainer").panel({iWheelStep:32});
        // }); 
        // 保留一位小数
        function round(v,e){
            var t=1;
            for(;e>0;t*=10,e--);
            for(;e<0;t/=10,e++);
            return Math.round(v*t)/t;
        }
    </script>
</body>
</html>